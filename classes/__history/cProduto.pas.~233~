unit cProduto;

interface

uses
  System.Classes, Vcl.Controls, Vcl.ExtCtrls, Vcl.Dialogs, System.SysUtils, datamodule, Data.DB;

Type
  TcProduto = class

  private
    FId: integer;
    FCodigo: Integer;
    FNomeProduto: string;
    FPreco: Double;
    FQuantidade: Integer;
    FFoto: TBytes;
    FIdCategoria: Integer;
    function getCodigo: integer;
    procedure setCodigo(const Value: integer);
    function getFoto: TBytes;
    function getIdCategoria: Integer;
    function getNomeProduto: string;
    function getPreco: Double;
    function getQuantidade: Integer;
    procedure setFoto(const Value: TBytes);
    procedure setIdCategoria(const Value: Integer);
    procedure setNomeProduto(const Value: string);
    procedure setPreco(const Value: Double);
    procedure setQuantidade(const Value: Integer);
    function getId: integer;
    procedure setId(const Value: integer);



  public
    procedure deleteColumnById(id: integer);
    procedure saveEntityToDBAlreadyExists(entity: TcProduto);
    class function getEntity(id: Integer): TcProduto;
    procedure saveEntityToDataBase(codigo: Integer;nome_produto: String;preco: Double;quantidade: Integer; foto_produto: TStream);
    constructor Create( ACodigo: Integer; ANome: string; APreco: Double; AQuantidade: Integer; AFoto: TBytes);

  published
    property id: integer read getId write setId;
    property codigo: integer read getCodigo write setCodigo;
    property nomeProduto: string read getNomeProduto write setNomeProduto;
    property preco: double read getPreco write setPreco;
    property quantidade: integer read getQuantidade write setQuantidade;
    property foto: TBytes read getFoto write setFoto;
    property id_categoria: integer read getIdCategoria write setIdCategoria;

  end;

implementation

{ TProduto }
constructor TcProduto.Create(
  ACodigo: Integer; ANome: string; APreco: Double; AQuantidade: Integer; AFoto: TBytes);
begin
  inherited Create;

  FCodigo := ACodigo;
  FNomeProduto := ANome;
  FPreco := APreco;
  FQuantidade := AQuantidade;
  FFoto := AFoto;
end;



class function TcProduto.getEntity(id: Integer): TcProduto;
begin
  with uDataModule.qryProdutoGetEntity do
  begin
    Close;
    Parameters.ParamByName('id').Value := id;
    Open;
      Result := TcProduto.Create(
        FieldByName('codigo').AsInteger,
        FieldByName('nome_produto').AsString,
        FieldByName('preco').AsFloat,
        FieldByName('quantidade').AsInteger,
        FieldByName('foto_produto').AsBytes
      );
      Result.id := FieldByName('id').AsInteger;
      end;
  end;

procedure TcProduto.saveEntityToDBAlreadyExists(entity: TcProduto);
var
   bs: TBytesStream;
begin
  bs := TBytesStream.Create(entity.foto);
  try
    if Length(entity.foto) > 0 then
    begin

      bs := TBytesStream.Create(entity.foto);
    end;

    with uDataModule.qryProdutoEdit do
    begin
      Close;
      Parameters.ParamByName('id').Value := entity.id;
      Parameters.ParamByName('codigo').Value := entity.codigo;
      Parameters.ParamByName('nome_produto').Value := entity.nomeProduto;
      Parameters.ParamByName('preco').Value := entity.preco;
      Parameters.ParamByName('quantidade').Value := entity.quantidade;

      if Length(entity.foto) > 0 then
        Parameters.ParamByName('foto_produto').LoadFromStream(ms, ftBlob);

      ExecSQL;
      ShowMessage('Alterado com sucesso!');
    end;
  finally
    bs.Free;
  end;

  uDataModule.qryProduto.Refresh;
end;


procedure TcProduto.saveEntityToDataBase
  (codigo: Integer;nome_produto: String;preco: Double;quantidade: Integer;foto_produto: TStream);
  begin
   with uDataModule.qryProdutoInsert do
      begin
        Close;
        Parameters.ParamByName('codigo').Value := codigo;
        Parameters.ParamByName('nome_produto').Value := nome_produto;
        Parameters.ParamByName('preco').Value := preco;
        Parameters.ParamByName('quantidade').Value := quantidade;
        Parameters.ParamByName('foto_produto').LoadFromStream(foto_produto, ftBlob);
        ExecSQL;
      end;
      uDataModule.qryProduto.Refresh;
  end;

procedure TcProduto.deleteColumnById(id: integer);
begin
  with uDataModule do
    begin
      qryProdutoDeleteById.Close;
      qryProdutoDeleteById.Parameters.ParamByName('id').Value := id;
      qryProdutoDeleteById.ExecSQL;
    end;
end;


function TcProduto.getCodigo: Integer;
begin
  Result := FCodigo;
end;

procedure TcProduto.setCodigo(const Value: Integer);
begin
  FCodigo := Value;
end;

function TcProduto.getNomeProduto: string;
begin
  Result := FNomeProduto;
end;

procedure TcProduto.setNomeProduto(const Value: string);
begin
  FNomeProduto := Value;
end;

function TcProduto.getPreco: Double;
begin
  Result := FPreco;
end;

procedure TcProduto.setPreco(const Value: Double);
begin
  FPreco := Value;
end;

function TcProduto.getQuantidade: Integer;
begin
  Result := FQuantidade;
end;

procedure TcProduto.setQuantidade(const Value: Integer);
begin
  FQuantidade := Value;
end;

function TcProduto.getFoto: TBytes;
begin
  Result := FFoto;
end;

procedure TcProduto.setFoto(const Value: TBytes);
begin
  FFoto := Value;
end;

function TcProduto.getId: integer;
begin
  Result := FId;
end;

function TcProduto.getIdCategoria: Integer;
begin
  Result := FIdCategoria;
end;

procedure TcProduto.setId(const Value: integer);
begin
   FId := value;
end;

procedure TcProduto.setIdCategoria(const Value: Integer);
begin
  FIdCategoria := Value;
end;


end.
